\[[<](./p0069.md)] \[[^](../README_ja.md)] \[[>](./p0071.md)]

# Problem 70: Totient Permutation

## The link to the problem

- [Totient Permutation](https://projecteuler.net/problem=70)

## My approach

素数 $p$ は $\phi(p) = p - 1$ が $p$ の並び替えにならないので、答えにならないのは明らかである。

したがって、求める答えは合成数 $N = p_{1}^{k_{1}} \ p_{2}^{k_{2}} \cdots p_{n}^{k_{n}}$ と仮定できる。
ただし $p_{i}$ は素数かつ $k_{i} \in \mathbb{Z} : k_{i} > 0$ である。

$$
\begin{align}
\phi(N) & = N(1 - 1/p_{1})(1 - 1/p_{2}) \cdots (1 - 1/p_{n}) \\
N / \phi(N) & = \frac{p_{1}}{p_{1} - 1} \ \frac{p_{2}}{p_{2} - 1} \cdots \frac{p_{n}}{p_{n} - 1}
\end{align}
$$

問題文より $\phi(87109) = 79180$ であり $87109 = 11 \cdot 7919$ なので

$$
\frac{87109}{\phi(87109)} = 1.100138923 \ldots
$$

そこで $7/\phi(7) = 1.1666 \ldots > 87109/\phi(87109)$ であることから、素数 $p_{i}$ は $p_{i} \ge 11$ である。

以上より、求める答え $N$ は以下のように表せる。

$$
N = p_{1}^{k_{1}} p_{2}^{k_{2}} \cdots p_{n}^{k_{n}} \quad (N < 10^7, \ 11 \le p_{1} < p_{2} < \cdots < p_{n} \le (10^7-1)/11, \ \text{$k_1 \geq 2$ when $n=1$})
$$

したがって $N$ のチェックを大きい素数 $p_{1} = 3137$ から小さい素数 $11$ の順番でおこなう。
これは最小の $n/\phi(n)$ を素早く見つけるために後述する枝刈りを実施するからである。
($3137$ は $\sqrt{10^{7}} = 3162.27 \ldots$ 以下で一番大きな素数)

このように探索すると $N$ は約 160 万通りのパターンが出てくる。

```
3137 * 3187
3137 * 3181
3137 * 3169
3137 * 3167
3137 * 3163
3137 * 3137
3121 * 3203
3121 * 3191
3121 * 3187
  ...
13 * 23 * 191
13 * 23 * 181 * 181    # Note: 13 * 23 * 181 * 181 = 9795539 < 10^7
13 * 23 * 181
13 * 23 * 179 * 181    # Note: 13 * 23 * 179 * 181 = 9687301 < 10^7
13 * 23 * 179 * 179
13 * 23 * 179
13 * 23 * 173 * 193    # Note: 13 * 23 * 173 * 193 = 9983311 < 10^7
13 * 23 * 173 * 191
13 * 23 * 173 * 181
13 * 23 * 173 * 179
13 * 23 * 173 * 173
13 * 23 * 173
13 * 23 * 167 * 199    # Note: 13 * 23 * 167 * 199 = 9936667 < 10^7
13 * 23 * 167 * 197
13 * 23 * 167 * 193
  ...
11 * 11 * 11 * 11 * 11 * 13
11 * 11 * 11 * 11 * 11 * 11
11 * 11 * 11 * 11 * 11
11 * 11 * 11 * 11
11 * 11 * 11
11 * 11
```

$N$ のチェックは前述の順番で行うものの、以下のルールに従って枝刈りをして不要な探索を省略するとチェックするパターンは大幅に削減できる。

1. もし $p_{1}p_{2}/\phi(p_{1}p_{2})$ が現在の最小 $n/\phi(n)$ より大きい場合は、次に小さい $p_{1}$ にスキップする
2. もし $p_{1}/\phi(p_{1})$ が現在の最小 $n/\phi(n)$ より大きい場合は、探索を終了する

#### Note

枝刈りの結果、チェックするのは素数 2 個の積だけで済む。
しかしながら求める解が素数 2 個の積であることは探索前に知ることはできないので、プログラムとしてはそれを前提にした実装にすることはできない。
